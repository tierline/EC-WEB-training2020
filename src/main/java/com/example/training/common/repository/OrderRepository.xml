<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper
	namespace="com.example.training.common.repository.OrderRepository">

	<insert id="save" useGeneratedKeys="true" keyProperty="id">
		insert
		into ORDERS (member_id, phone, name, address, email, price, date)
		values(
		"${memberId}",
		"${phone}",
		"${name}",
		"${address}",
		"${email}",
		${price},
		"${date}")
	</insert>

	<insert id="saveItem">
		insert into ORDER_ITEMS (order_id, name, price,
		quantity, image_path)
		values(
		${id},
		"${item.name}",
		${item.price},
		${item.quantity},
		"${item.imagePath}"
		)
	</insert>

	<select id="findItemsByOrder"
		resultType="com.example.training.common.domain.OrderItem">
		select
		name, price, quantity
		from
		ORDER_ITEMS
		where order_id =
		${id}

	</select>

	<select id="findById"
		resultType="com.example.training.common.domain.Order">
		select
		*
		from
		ORDERS
		where id = ${id}

	</select>

	<select id="findByOrderDate"
		resultType="com.example.training.common.domain.OrderHistory">
		select
		m.id,
		o.id as "orderId",
		date_format(o.`date`, "%Y年%m月") as orderMonth,
		date_format(o.`date`, "%m月%d日") as orderDay
		from
		ORDERS as o
		left join
		MEMBERS as m
		on m.id = o.member_id
		where m.id =
		${id}
	</select>

	<select id="findItemByOrderHistory"
		resultType="com.example.training.common.domain.OrderHistory">
		select
		name,
		price as "unitPrice",
		quantity,
		image_path as
		"imagePath"
		from
		ORDER_ITEMS
		where order_id = ${id}
	</select>
	
</mapper>
