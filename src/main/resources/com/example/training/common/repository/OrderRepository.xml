<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper
	namespace="com.example.training.common.repository.OrderRepository">

	<insert id="save" useGeneratedKeys="true" keyProperty="id">
		INSERT
		INTO ORDERS (member_id, phone_number, name, address, email, price, date)
		VALUES(
		"${memberId.value}",
		"${phoneNumber.value}",
		"${fullName.firstName}",
		"${address.value}",
		"${email}",
		${price},
		"${date}")
	</insert>

	<insert id="saveItem">
		INSERT INTO ORDER_ITEM (order_id, name, price,
		quantity, image_path)
		VALUES(
		${id},
		"${item.name}",
		${item.price},
		${item.quantity},
		"${item.imagePath}"
		)
	</insert>

	<select id="findItemsByOrder"
		resultType="com.example.training.common.domain.OrderItem">
		SELECT
		name, price, quantity
		FROM
		ORDER_ITEM
		WHERE order_id =
		${id}

	</select>

	<select id="findById"
		resultType="com.example.training.common.domain.Order">
		SELECT
		*
		FROM
		ORDERS
		WHERE id = ${id}
	</select>

	<select id="findByOrderMonthByMemberId"
		resultType="com.example.training.common.domain.OrderMonth">
		SELECT
		id as orderId,
		`date`
		FROM ORDERS AS o
		WHERE member_id = ${id}
		ORDER BY `date` DESC
	</select>

	<select id="findByOrderItem"
		resultType="com.example.training.common.domain.OrderItem">
		SELECT
		name,
		price,
		quantity,
		image_path
		FROM
		ORDER_ITEM
		WHERE order_id = ${id}
	</select>

</mapper>
