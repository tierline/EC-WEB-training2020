<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper
	namespace="com.example.training.common.repository.OrderRepository">

	<insert id="save" useGeneratedKeys="true" keyProperty="id">
		insert
		into orders (member_id, phone, name, address, email, price, date)
		values(
		"${memberId}",
		"${phone}",
		"${name}",
		"${address}",
		"${email}",
		${price},
		"${date}")
	</insert>

	<insert id="saveItem">
		insert into order_items (order_id, name, price,
		quantity)
		values(
		${id},
		"${item.name}",
		${item.price},
		${item.quantity}
		)
	</insert>

	<select id="findItemsByOrder"
		resultType="com.example.training.common.domain.OrderItem">
		select
		name, price, quantity
		from
		order_items
		where order_id =
		${id}

	</select>

	<select id="findById"
		resultType="com.example.training.common.domain.Order">
		select
		*
		from
		orders
		where id = ${id}

	</select>

	<select id="findItemByOrderHistory"
		resultType="com.example.training.common.domain.OrderHistory">
		select
		m.id as "memberId",
		o.id as "orderId",
		oi.name,
		oi.price as "unitPrice",
		oi.quantity,
		o.`date`
		from
		orders as o
		left join
		order_items as oi
		on o.id = oi.order_id
		left
		join
		member as m
		on m.id = o.member_id
		where m.id = ${id}
	</select>
</mapper>
