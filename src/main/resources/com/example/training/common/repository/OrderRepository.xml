<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper
	namespace="com.example.training.common.repository.OrderRepository">

	<insert id="create" useGeneratedKeys="true" keyProperty="id">
		INSERT
		INTO ORDERS (member_id, phone_number, name, address, email, price, date)
		VALUES(
		"${memberId.value}",
		"${phoneNumber.value}",
		"${fullName.value}",
		"${address.value}",
		"${email.value}",
		${totalPrice.value},
		"${orderDateAndTime.value}")
	</insert>

	<insert id="createItem">
		INSERT INTO ORDER_ITEM (order_id, name, price,
		quantity, image_path)
		VALUES(
		"${orderItem.orderId.value}",
		"${orderItem.productName}",
		"${orderItem.productPrice.value}",
		"${orderItem.productQuantity.value}",
		"${orderItem.productImagePath}"
		)
	</insert>

	<select id="findOrderItemsByOrderId"
		resultType="com.example.training.web.domain.order.OrderItem">
		SELECT
		name, price, quantity, image_path
		FROM
		ORDER_ITEM
		WHERE order_id =
		${value}
	</select>


	<select id="findByOrderId"
resultType="com.example.training.web.domain.order.Order">
		SELECT
		*
		FROM
		ORDERS
		WHERE id = ${value}
	</select>

	<select id="findOrderHistoryByMonthByMemberId"
		resultType="com.example.training.web.domain.order.OrderHistoryByMonth">
		SELECT
		id as orderId,
		`date`
		FROM ORDERS AS o
		WHERE member_id = ${value}
		ORDER BY `date` DESC
	</select>

</mapper>
